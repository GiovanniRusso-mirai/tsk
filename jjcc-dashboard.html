<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JJCC ‚Äî Stampa Brackets</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Segoe UI',Arial,sans-serif;background:#1a1a2e;color:#eee;padding:20px}
.screen-ui{text-align:center;padding:24px 12px 12px}
.screen-ui h1{font-size:1.6rem;font-weight:800;letter-spacing:2px;color:#f5c842}
.screen-ui p{color:#777;font-size:.8rem;margin:6px 0 16px}
.btns{display:flex;justify-content:center;gap:6px;flex-wrap:wrap;margin-bottom:20px}
.btn{padding:8px 18px;border-radius:6px;cursor:pointer;font-weight:700;font-size:.78rem;border:1px solid #444;background:#222;color:#aaa;font-family:inherit;transition:.15s}
.btn:hover{border-color:#888;color:#fff}
.btn.on{border-color:#3b82f6;color:#3b82f6;background:rgba(59,130,246,.12)}
.btn.go{background:#f5c842;color:#111;border-color:#f5c842}
.btn.go:hover{background:#ffd866}
.a4{width:210mm;background:#fff;color:#000;margin:12px auto;padding:10mm 12mm 14mm;position:relative;page-break-after:always;box-shadow:0 4px 30px rgba(0,0,0,.6)}
.a4:last-child{page-break-after:auto}
.ph{display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid #222;padding-bottom:6px;margin-bottom:10px}
.ph h2{font-size:.95rem;font-weight:800;letter-spacing:2px;text-transform:uppercase}
.tag{font-size:.6rem;font-weight:800;padding:2px 8px;border-radius:3px;color:#fff;text-transform:uppercase;letter-spacing:.5px}
.tag-kick{background:#2563eb}.tag-lotta{background:#7c3aed}.tag-kumite{background:#dc2626}
.cb{margin-bottom:12px;padding-bottom:10px;border-bottom:1px dashed #ccc}
.cb:last-child{border-bottom:none;margin-bottom:0}
.cl{font-size:.78rem;font-weight:800;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.cl .n{font-size:.55rem;font-weight:600;color:#888;background:#f0f0f0;padding:1px 6px;border-radius:3px}
.pf{position:absolute;bottom:8mm;left:12mm;right:12mm;display:flex;justify-content:space-between;font-size:.45rem;color:#aaa;border-top:1px solid #eee;padding-top:3px}
@media print{
    body{background:#fff;padding:0}
    .screen-ui,.btns{display:none!important}
    .a4{box-shadow:none;margin:0;padding:8mm 10mm 12mm}
    @page{size:A4 portrait;margin:0}
}
</style>
</head>
<body>
<div class="screen-ui">
    <h1>üñ®Ô∏è STAMPA BRACKETS</h1>
    <p>Ogni foglio A4 contiene pi√π categorie. Clicca Stampa o Ctrl+P.</p>
</div>
<div class="btns">
    <button class="btn on" onclick="go('all',this)">Tutte</button>
    <button class="btn" onclick="go('kick',this)">Kick Jitsu</button>
    <button class="btn" onclick="go('lotta',this)">Lotta a Terra</button>
    <button class="btn" onclick="go('kumite',this)">Kumit√® Kids</button>
    <button class="btn go" onclick="window.print()">üñ®Ô∏è Stampa</button>
</div>
<div id="out"></div>

<script>
const rawData=[
{d:'kick',n:'MATTEO PESCE',s:'M',w:75.0,a:15,g:'ASD BUSHIDO'},{d:'kick',n:'IVAN CASABURI',s:'M',w:38.6,a:13,g:'TAI SHIN KAI'},{d:'kick',n:'ANTONIO TESSITORE',s:'M',w:57.0,a:10,g:'TAI SHIN KAI'},{d:'kick',n:'MARIO BATTISTA',s:'M',w:46.7,a:11,g:'TAI SHIN KAI'},{d:'kick',n:'MICHELE BORTONE',s:'M',w:67.0,a:11,g:'TAI SHIN KAI'},{d:'kick',n:'GIUSEPPE SIENO',s:'M',w:58.1,a:12,g:'TAI SHIN KAI'},{d:'kick',n:'SAMUELE CHIARIELLO',s:'M',w:34.0,a:12,g:'TAI SHIN KAI'},{d:'kick',n:'FIORELLA CARBISIERO',s:'F',w:60.0,a:13,g:'TAI SHIN KAI'},{d:'kick',n:'FABIO DI SANTO',s:'M',w:42.0,a:11,g:'TAI SHIN KAI'},{d:'kick',n:'DOMENICO DI GIORGIO',s:'M',w:81.0,a:14,g:'TAI SHIN KAI'},{d:'kick',n:'PASQUALE BELARDO',s:'M',w:73.5,a:12,g:'TAI SHIN KAI'},{d:'kick',n:'LUCA D\'AMBRA',s:'M',w:42.0,a:13,g:'TAI SHIN KAI'},{d:'kick',n:'ALESSANDRO GRANIGLIA',s:'M',w:71.0,a:15,g:'SSD LIFE'},{d:'kick',n:'RAOUL GIANLAVIGNA',s:'M',w:70.1,a:15,g:'SSD LIFE'},{d:'kick',n:'CHRISTIAN CORRADO',s:'M',w:50.0,a:14,g:'SSD LIFE'},{d:'kick',n:'MATTEO COZZOLINO',s:'M',w:60.0,a:14,g:'SSD LIFE'},{d:'kick',n:'FRANCESCO CAPPETTA',s:'M',w:45.0,a:14,g:'SSD LIFE'},{d:'kick',n:'GABRIEL CACCIOPPOLI',s:'M',w:63.0,a:14,g:'SSD LIFE'},{d:'kick',n:'RAFFAELE BORRELLI',s:'M',w:54.0,a:12,g:'SSD LIFE'},{d:'kick',n:'JASMINE DI MARZO',s:'F',w:89.0,a:12,g:'SSD LIFE'},{d:'kick',n:'VITTORIA MARTUSCIELLO',s:'F',w:63.0,a:12,g:'SSD LIFE'},{d:'kick',n:'SIMONE CATURANO',s:'M',w:34.0,a:12,g:'SSD LIFE'},{d:'kick',n:'FABRIZIO MINOPOLI',s:'M',w:39.0,a:12,g:'SSD LIFE'},{d:'kick',n:'CHRISTIAN CATURANO',s:'M',w:26.0,a:11,g:'SSD LIFE'},{d:'kick',n:'CHRISTIAN DE ANGELIS',s:'M',w:33.0,a:10,g:'SSD LIFE'},{d:'kick',n:'ROMEO MONTELLA',s:'M',w:28.0,a:10,g:'SSD LIFE'},{d:'kick',n:'GABRIELE IMPROTA',s:'M',w:44.0,a:11,g:'SSD LIFE'},{d:'kick',n:'VINCENZO OMBRA',s:'M',w:44.0,a:10,g:'SSD LIFE'},{d:'kick',n:'ALESSANDRO TONELLI',s:'M',w:54.0,a:10,g:'SSD LIFE'},{d:'kick',n:'LUIGI DEL SOLE',s:'M',w:27.0,a:9,g:'SSD LIFE'},{d:'kick',n:'MARIO INGENITO',s:'M',w:39.0,a:10,g:'SSD LIFE'},{d:'kick',n:'VINCENZO DI VICINO',s:'M',w:21.0,a:7,g:'SSD LIFE'},{d:'kick',n:'SANTORO MELYSSA',s:'F',w:25.0,a:11,g:'ASD CS BODY ART'},{d:'kick',n:'VIETRI ILARIA',s:'F',w:26.0,a:11,g:'ASD CS BODY ART'},{d:'kick',n:'PLAITANO LIDIA',s:'F',w:45.0,a:10,g:'ASD CS BODY ART'},{d:'kick',n:'MAZZEO LINDA',s:'F',w:29.0,a:11,g:'ASD CS BODY ART'},{d:'kick',n:'NAPPI ALESSANDRA',s:'F',w:33.0,a:11,g:'ASD CS BODY ART'},{d:'kick',n:'CASABURI RAFFAELLA',s:'F',w:68.0,a:13,g:'ASD CS BODY ART'},{d:'kick',n:'LANDI MICHELA',s:'F',w:48.0,a:14,g:'ASD CS BODY ART'},{d:'kick',n:'RICCO MORGAN',s:'M',w:63.0,a:10,g:'ASD CS BODY ART'},{d:'kick',n:'VITALE PIETRO',s:'M',w:40.0,a:11,g:'ASD CS BODY ART'},{d:'kick',n:'CASTELLUCCIO GIUSEPPE',s:'M',w:45.0,a:10,g:'ASD CS BODY ART'},{d:'kick',n:'CASABURI ALFONSO',s:'M',w:57.0,a:13,g:'ASD CS BODY ART'},{d:'kick',n:'ALFIERO FRANCESCO',s:'M',w:29.0,a:12,g:'ASD CS BODY ART'},
{d:'kumite',n:'LEONARDO OLIVA',s:'M',w:20.5,a:3,g:'ASD BUSHIDO'},{d:'kumite',n:'GIUSEPPE PASCARELLA',s:'M',w:30.0,a:6,g:'TAI SHIN KAI'},{d:'kumite',n:'RAFFAELA FERRARA',s:'F',w:28.0,a:7,g:'TAI SHIN KAI'},{d:'kumite',n:'GABRIEL FERRARA',s:'M',w:21.0,a:6,g:'TAI SHIN KAI'},{d:'kumite',n:'ANTONIO FUSCO',s:'M',w:21.0,a:6,g:'TAI SHIN KAI'},{d:'kumite',n:'VERONICA CASTALDO',s:'F',w:36.0,a:8,g:'TAI SHIN KAI'},{d:'kumite',n:'MARIA BENCIVENGA',s:'F',w:38.0,a:8,g:'TAI SHIN KAI'},{d:'kumite',n:'PIETRO FORTINO',s:'M',w:45.0,a:9,g:'TAI SHIN KAI'},{d:'kumite',n:'ARTEM PEREHKREST',s:'M',w:35.0,a:7,g:'TAI SHIN KAI'},{d:'kumite',n:'ANTONIO DI MURO',s:'M',w:42.0,a:9,g:'TAI SHIN KAI'},{d:'kumite',n:'RAFFAELE DI MURO',s:'M',w:22.0,a:6,g:'TAI SHIN KAI'},{d:'kumite',n:'VITO BORTONE',s:'M',w:21.0,a:6,g:'TAI SHIN KAI'},{d:'kumite',n:'EDUARDO PEZZULLO',s:'M',w:25.0,a:7,g:'TAI SHIN KAI'},{d:'kumite',n:'REBECCA MICILLO',s:'F',w:32.0,a:8,g:'TAI SHIN KAI'},{d:'kumite',n:'SARA IOVINELLA',s:'F',w:36.0,a:8,g:'TAI SHIN KAI'},{d:'kumite',n:'DOMENICO MOZZILLO',s:'M',w:23.0,a:8,g:'TAI SHIN KAI'},{d:'kumite',n:'GIOIA BELARDO',s:'F',w:30.0,a:10,g:'TAI SHIN KAI'},{d:'kumite',n:'MARIO BUONANNO',s:'M',w:32.0,a:6,g:'TAI SHIN KAI'},{d:'kumite',n:'ROBERTO RUSSO',s:'M',w:42.0,a:9,g:'TAI SHIN KAI'},{d:'kumite',n:'MATTHIAS LONGOBARDI',s:'M',w:31.0,a:7,g:'SSD LIFE'},{d:'kumite',n:'VINCENZO CHIANESE',s:'M',w:22.0,a:6,g:'SSD LIFE'},
{d:'lotta',n:'ALESSANDRO PESCE',s:'M',w:40.0,a:10,g:'ASD BUSHIDO'},{d:'lotta',n:'AARON CALCE',s:'M',w:54.0,a:12,g:'ASD BUSHIDO'},{d:'lotta',n:'MATTEO MASI',s:'M',w:46.0,a:11,g:'ASD BUSHIDO'},{d:'lotta',n:'GIOVANNI ROTONDO',s:'M',w:45.0,a:9,g:'ASD BUSHIDO'},{d:'lotta',n:'VINCENZO STABILE',s:'M',w:29.0,a:8,g:'ASD BUSHIDO'},{d:'lotta',n:'ANTONIA DI STASIO',s:'F',w:54.7,a:10,g:'ASD BUSHIDO'},{d:'lotta',n:'MATTEO PESCE',s:'M',w:75.0,a:15,g:'ASD BUSHIDO'},{d:'lotta',n:'ALESSIA DELLI COLLI',s:'F',w:45.0,a:11,g:'ASD BUSHIDO'},{d:'lotta',n:'ASIA RESARCHI',s:'F',w:37.0,a:12,g:'ASD BUSHIDO'},{d:'lotta',n:'ANTONIO MARANDOLA',s:'M',w:67.0,a:11,g:'ASD BUSHIDO'},{d:'lotta',n:'INSAFE KHADRA',s:'F',w:39.0,a:11,g:'TAI SHIN KAI'},{d:'lotta',n:'RITYA HASSANI',s:'F',w:29.8,a:8,g:'TAI SHIN KAI'},{d:'lotta',n:'ANTONIO LUONGO',s:'M',w:55.0,a:11,g:'TAI SHIN KAI'},{d:'lotta',n:'ALESSANDRO RUGGIANO',s:'M',w:39.7,a:10,g:'TAI SHIN KAI'},{d:'lotta',n:'IVAN CASABURI',s:'M',w:38.6,a:13,g:'TAI SHIN KAI'},{d:'lotta',n:'ANTONIO TESSITORE',s:'M',w:57.0,a:10,g:'TAI SHIN KAI'},{d:'lotta',n:'MARIO BATTISTA',s:'M',w:46.7,a:11,g:'TAI SHIN KAI'},{d:'lotta',n:'MICHELE BORTONE',s:'M',w:67.0,a:11,g:'TAI SHIN KAI'},{d:'lotta',n:'GIUSEPPE SIENO',s:'M',w:58.1,a:12,g:'TAI SHIN KAI'},{d:'lotta',n:'SAMUELE CHIARIELLO',s:'M',w:34.0,a:12,g:'TAI SHIN KAI'},{d:'lotta',n:'FIORELLA CARBISIERO',s:'F',w:60.0,a:13,g:'TAI SHIN KAI'},{d:'lotta',n:'FABIO DI SANTO',s:'M',w:42.0,a:11,g:'TAI SHIN KAI'},{d:'lotta',n:'CIRO ARCIPRETE',s:'M',w:61.0,a:14,g:'TAI SHIN KAI'},{d:'lotta',n:'PASQUALE BELARDO',s:'M',w:73.5,a:12,g:'TAI SHIN KAI'},{d:'lotta',n:'NICOLA SIENO',s:'M',w:49.0,a:11,g:'TAI SHIN KAI'},{d:'lotta',n:'HAROUN KHADRA',s:'M',w:26.0,a:7,g:'TAI SHIN KAI'},{d:'lotta',n:'SALVATORE LUONGO',s:'M',w:26.2,a:8,g:'TAI SHIN KAI'},{d:'lotta',n:'ALESSANDRO TESSITORE',s:'M',w:40.0,a:8,g:'TAI SHIN KAI'},{d:'lotta',n:'CLAUDIA VITALE',s:'F',w:27.1,a:8,g:'TAI SHIN KAI'},{d:'lotta',n:'RITAJ HASSANI',s:'F',w:40.8,a:9,g:'TAI SHIN KAI'},{d:'lotta',n:'DIEGO RUGGIANO',s:'M',w:28.7,a:8,g:'TAI SHIN KAI'},{d:'lotta',n:'NICHOLAS D\'ANGELO',s:'M',w:30.5,a:8,g:'TAI SHIN KAI'},{d:'lotta',n:'RAFFAELE PEZZELLA',s:'M',w:43.0,a:8,g:'TAI SHIN KAI'},{d:'lotta',n:'SILVANA MUROLO',s:'F',w:31.1,a:8,g:'TAI SHIN KAI'},{d:'lotta',n:'SALVATORE BELARDO',s:'M',w:25.8,a:8,g:'TAI SHIN KAI'},{d:'lotta',n:'RAFFAELE CAPASSO',s:'M',w:25.0,a:8,g:'TAI SHIN KAI'},{d:'lotta',n:'ANTONIO MERENDA',s:'M',w:58.0,a:10,g:'TAI SHIN KAI'},{d:'lotta',n:'ALESSANDRO GRANIGLIA',s:'M',w:71.0,a:15,g:'SSD LIFE'},{d:'lotta',n:'RAOUL GIANLAVIGNA',s:'M',w:70.1,a:15,g:'SSD LIFE'},{d:'lotta',n:'CHRISTIAN CORRADO',s:'M',w:50.0,a:14,g:'SSD LIFE'},{d:'lotta',n:'MATTEO COZZOLINO',s:'M',w:60.0,a:14,g:'SSD LIFE'},{d:'lotta',n:'FRANCESCO CAPPETTA',s:'M',w:45.0,a:14,g:'SSD LIFE'},{d:'lotta',n:'GABRIEL CACCIOPPOLI',s:'M',w:63.0,a:14,g:'SSD LIFE'},{d:'lotta',n:'RAFFAELE BORRELLI',s:'M',w:54.0,a:12,g:'SSD LIFE'},{d:'lotta',n:'JASMINE DI MARZO',s:'F',w:89.0,a:12,g:'SSD LIFE'},{d:'lotta',n:'VITTORIA MARTUSCIELLO',s:'F',w:63.0,a:12,g:'SSD LIFE'},{d:'lotta',n:'SIMONE CATURANO',s:'M',w:34.0,a:12,g:'SSD LIFE'},{d:'lotta',n:'FABRIZIO MINOPOLI',s:'M',w:39.0,a:12,g:'SSD LIFE'},{d:'lotta',n:'CHRISTIAN CATURANO',s:'M',w:26.0,a:11,g:'SSD LIFE'},{d:'lotta',n:'CHRISTIAN DE ANGELIS',s:'M',w:33.0,a:10,g:'SSD LIFE'},{d:'lotta',n:'ROMEO MONTELLA',s:'M',w:28.0,a:10,g:'SSD LIFE'},{d:'lotta',n:'GABRIELE IMPROTA',s:'M',w:44.0,a:11,g:'SSD LIFE'},{d:'lotta',n:'VINCENZO OMBRA',s:'M',w:44.0,a:10,g:'SSD LIFE'},{d:'lotta',n:'ALESSANDRO TONELLI',s:'M',w:54.0,a:10,g:'SSD LIFE'},{d:'lotta',n:'LUIGI DEL SOLE',s:'M',w:27.0,a:9,g:'SSD LIFE'},{d:'lotta',n:'MARIO INGENITO',s:'M',w:39.0,a:10,g:'SSD LIFE'},{d:'lotta',n:'VINCENZO DI VICINO',s:'M',w:21.0,a:7,g:'SSD LIFE'},{d:'lotta',n:'VINCENZO CHIANESE',s:'M',w:22.0,a:6,g:'SSD LIFE'},{d:'lotta',n:'MATTHIAS LONGOBARDI',s:'M',w:31.0,a:7,g:'SSD LIFE'},{d:'lotta',n:'SANTORO MELYSSA',s:'F',w:25.0,a:11,g:'ASD CS BODY ART'},{d:'lotta',n:'VIETRI ILARIA',s:'F',w:26.0,a:11,g:'ASD CS BODY ART'},{d:'lotta',n:'PLAITANO LIDIA',s:'F',w:45.0,a:10,g:'ASD CS BODY ART'},{d:'lotta',n:'MAZZEO LINDA',s:'F',w:29.0,a:11,g:'ASD CS BODY ART'},{d:'lotta',n:'NAPPI ALESSANDRA',s:'F',w:33.0,a:11,g:'ASD CS BODY ART'},{d:'lotta',n:'CASABURI RAFFAELLA',s:'F',w:68.0,a:13,g:'ASD CS BODY ART'},{d:'lotta',n:'LANDI MICHELA',s:'F',w:48.0,a:14,g:'ASD CS BODY ART'},{d:'lotta',n:'RICCO MORGAN',s:'M',w:63.0,a:10,g:'ASD CS BODY ART'},{d:'lotta',n:'VITALE PIETRO',s:'M',w:40.0,a:11,g:'ASD CS BODY ART'},{d:'lotta',n:'CASTELLUCCIO GIUSEPPE',s:'M',w:45.0,a:10,g:'ASD CS BODY ART'},{d:'lotta',n:'CASABURI ALFONSO',s:'M',w:57.0,a:13,g:'ASD CS BODY ART'},{d:'lotta',n:'ALFIERO FRANCESCO',s:'M',w:29.0,a:12,g:'ASD CS BODY ART'},{d:'lotta',n:'STAN ROBERT',s:'M',w:45.0,a:15,g:'ASD CS BODY ART'},{d:'lotta',n:'SARA IOVINELLA',s:'F',w:36.0,a:8,g:'TAI SHIN KAI'},{d:'lotta',n:'ANDREA RAINONE',s:'M',w:53.0,a:12,g:'TAI SHIN KAI'}
];
const manualMatches={'kick':{'M (10-11) -45':[['MARIO BATTISTA','BYE']],'M (14-15) -65':[['GABRIEL CACCIOPPOLI','MATTEO COZZOLINO']],'M (14-15) +70':[['ALESSANDRO GRANIGLIA','MATTEO PESCE'],['DOMENICO DI GIORGIO','RAOUL GIANLAVIGNA']]},'lotta':{'F (8-9) -35':[['SILVANA MUROLO','BYE']],'F (8-9) -30':[['RITYA HASSANI','CLAUDIA VITALE']],'M (8-9) -27':[['RAFFAELE CAPASSO','SALVATORE BELARDO'],['LUIGI DEL SOLE','SALVATORE LUONGO']],'M (8-9) -31':[['NICHOLAS D\'ANGELO','VINCENZO STABILE'],['DIEGO RUGGIANO','BYE']],'M (10-11) -50':[['MATTEO MASI','NICOLA SIENO'],['MARIO BATTISTA','BYE']],'M (10-11) +55':[['ANTONIO TESSITORE','RICCO MORGAN'],['ANTONIO MARANDOLA','MICHELE BORTONE'],['ANTONIO MERENDA','BYE']],'M (14-15) -65':[['CIRO ARCIPRETE','MATTEO COZZOLINO'],['GABRIEL CACCIOPPOLI','BYE']],'M (14-15) +70':[['RAOUL GIANLAVIGNA','BYE'],['ALESSANDRO GRANIGLIA','MATTEO PESCE']]},'kumite':{'MIX (8-9) -45':[['ANTONIO DI MURO','ROBERTO RUSSO'],['ARTEM PEREHKREST','PIETRO FORTINO']]}};
const hiddenCategories=['M (14-15) -60','M (14-15) -70','MIX (6-7) -37','MIX (8-9) -50','M (8-9) -30'];
const discHidden={'kick':['M (10-11) -45']};

function getCategory(a){if(a.d==='kick')return ck(a);if(a.d==='lotta')return cl(a);return cm(a)}
function ck(a){let g,l;if(a.a<=7){g='6-7';l=[20,24,28,32,37]}else if(a.a<=9){g='8-9';l=[23,27,31,35,40,45]}else if(a.a<=11){g='10-11';l=[28,32,36,40,45,50]}else if(a.a<=13){g='12-13';l=[30,35,40,45,50,55]}else if(a.a<=15){g='14-15';l=[40,45,50,55,60,65,70]}else{g='18+';l=[50,55,60,65,70,75,80]}return fc(a.s,g,a.w,l)}
function cl(a){let g,l;if(a.a<=7){g='6-7';l=[20,24,28,32,37]}else if(a.a<=9){g='8-9';l=[23,27,30,31,35,40,45,50]}else if(a.a<=11){g='10-11';l=[28,32,36,40,45,50,55]}else if(a.a<=13){g='12-13';l=[30,35,40,45,50,55,60]}else if(a.a<=15){g='14-15';l=[40,45,50,55,60,65,70]}else{g='18-40';l=[57,63,69,74,79,84,89]}return fc(a.s,g,a.w,l)}
function cm(a){let g,l;if(a.a<=5){g='3-5';l=[20]}else if(a.a<=7){g='6-7';l=[20,24,28,32,37]}else if(a.a<=9){g='8-9';l=[23,27,31,35,40,45,50]}else{g='10-11';l=[28,32,36,40,45,50]}return fc('MIX',g,a.w,l)}
function fc(s,age,w,lim){let wc=`+${lim[lim.length-1]}`;for(let l of lim)if(w<=l){wc=`-${l}`;break}return`${s} (${age}) ${wc}`}

function buildAll(disc){
    const pool=rawData.filter(a=>a.d===disc);
    const cp=pool.map(a=>({...a,cat:getCategory(a)}));
    const gr={};cp.forEach(a=>{if(!gr[a.cat])gr[a.cat]=[];gr[a.cat].push(a)});
    const sorted=Object.keys(gr).sort((a,b)=>{const x=parseInt(a.match(/\((\d+)/)?.[1]||0),y=parseInt(b.match(/\((\d+)/)?.[1]||0);return x!==y?x-y:a.localeCompare(b)});
    const res=[];
    sorted.forEach(cat=>{
        if(hiddenCategories.includes(cat))return;
        if(discHidden[disc]&&discHidden[disc].includes(cat))return;
        const g=[...gr[cat]].sort((a,b)=>a.w-b.w);const m=[];
        if(manualMatches[disc]&&manualMatches[disc][cat]){
            manualMatches[disc][cat].forEach(p=>{const f=name=>pool.find(x=>x.n.toUpperCase().trim()===name.toUpperCase().trim());const a1=f(p[0])||{n:p[0],g:''};const a2=p[1]==='BYE'?{n:'BYE',g:''}:(f(p[1])||{n:p[1],g:''});m.push({a1,a2})});
        }else{const q=[...g];if(q.length===1)m.push({solo:q[0]});else while(q.length>0){if(q.length===1){m.push({a1:q.shift(),a2:{n:'BYE',g:''}});continue}const p1=q.shift();let i=q.findIndex(x=>x.g!==p1.g);if(i===-1)i=0;m.push({a1:p1,a2:q.splice(i,1)[0]})}}
        res.push({cat,cnt:g.length,matches:m,disc});
    });
    return res;
}

// ====== SVG BRACKET DRAWING ======
const SH=22,SW=148,GAP=4,MGAP=12,CON=24,LW=1.2;

function sg(g){return g?g.replace('ASD CS ','').replace('ASD ','').replace('SSD ',''):''}

function slot(x,y,name,gym,bye){
    const bg=bye?'#f8f8f8':'#fff',tc=bye?'#bbb':'#000',fi=bye?'italic':'normal';
    let s=`<rect x="${x}" y="${y}" width="${SW}" height="${SH}" fill="${bg}" stroke="#555" stroke-width="${LW}" rx="1"/>`;
    if(!bye&&name){
        s+=`<text x="${x+5}" y="${y+14}" font-size="7.5" fill="${tc}" font-style="${fi}" font-weight="600" font-family="Arial">${name}</text>`;
        if(gym)s+=`<text x="${x+SW-4}" y="${y+14}" font-size="5.5" fill="#999" text-anchor="end" font-family="Arial">${sg(gym)}</text>`;
    }else{
        s+=`<text x="${x+5}" y="${y+14}" font-size="7" fill="#bbb" font-style="italic" font-family="Arial">BYE</text>`;
    }
    return s;
}

function empty(x,y){
    return`<rect x="${x}" y="${y}" width="${SW}" height="${SH}" fill="#fffce8" stroke="#c9a000" stroke-width="${LW}" rx="1" stroke-dasharray="4,2"/>`;
}

function ln(x1,y1,x2,y2){return`<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="#555" stroke-width="${LW}"/>`}

function trophy(x,y){return`<text x="${x}" y="${y}" font-size="13">üèÜ</text>`}

// Draw connector from two midpoints to output
function conn(x,midTop,midBot){
    const mx=x+CON/2;const midY=(midTop+midBot)/2;
    return ln(x,midTop,mx,midTop)+ln(x,midBot,mx,midBot)+ln(mx,midTop,mx,midBot)+ln(mx,midY,x+CON,midY);
}

function drawBracket(c){
    const{matches:mm}=c;

    // SOLO
    if(mm.length===1&&mm[0].solo){
        const a=mm[0].solo;const w=SW+70,h=SH+6;
        return`<svg width="${w}" height="${h}" xmlns="http://www.w3.org/2000/svg">${slot(0,3,a.n,a.g,false)}<text x="${SW+8}" y="${16}" font-size="6.5" fill="#999" font-style="italic" font-family="Arial">unico iscritto</text></svg>`;
    }

    // 1 MATCH (2 athletes)
    if(mm.length===1){
        const m=mm[0];const y1=2,y2=y1+SH+GAP;const mid=(y1+SH/2+y2+SH/2)/2;
        const w=SW+CON+SW+20,h=y2+SH+4;
        let s=`<svg width="${w}" height="${h}" xmlns="http://www.w3.org/2000/svg">`;
        s+=slot(0,y1,m.a1.n,m.a1.g,m.a1.n==='BYE');
        s+=slot(0,y2,m.a2.n,m.a2.g,m.a2.n==='BYE');
        s+=conn(SW,y1+SH/2,y2+SH/2);
        s+=empty(SW+CON,mid-SH/2);
        s+=trophy(SW+CON+SW+4,mid+4);
        return s+'</svg>';
    }

    // 2 MATCHES (3-4 athletes) ‚Üí semi + final
    if(mm.length===2){
        const mH=SH*2+GAP;const y1=2,y2=y1+mH+MGAP;
        const mid1=y1+SH+GAP/2,mid2=y2+SH+GAP/2;
        const w=SW+CON+SW+CON+SW+20,h=y2+mH+4;
        let s=`<svg width="${w}" height="${h}" xmlns="http://www.w3.org/2000/svg">`;
        // R1 match 1
        s+=slot(0,y1,mm[0].a1.n,mm[0].a1.g,mm[0].a1.n==='BYE');
        s+=slot(0,y1+SH+GAP,mm[0].a2.n,mm[0].a2.g,mm[0].a2.n==='BYE');
        s+=conn(SW,y1+SH/2,y1+SH+GAP+SH/2);
        // R1 match 2
        s+=slot(0,y2,mm[1].a1.n,mm[1].a1.g,mm[1].a1.n==='BYE');
        s+=slot(0,y2+SH+GAP,mm[1].a2.n,mm[1].a2.g,mm[1].a2.n==='BYE');
        s+=conn(SW,y2+SH/2,y2+SH+GAP+SH/2);
        // Semi slots
        s+=empty(SW+CON,mid1-SH/2);
        s+=empty(SW+CON,mid2-SH/2);
        // Semi‚ÜíFinal connector
        s+=conn(SW+CON+SW,mid1,mid2);
        const finalMid=(mid1+mid2)/2;
        s+=empty(SW+CON+SW+CON,finalMid-SH/2);
        s+=trophy(SW+CON+SW+CON+SW+4,finalMid+4);
        return s+'</svg>';
    }

    // 3 MATCHES (5-6 athletes)
    if(mm.length===3){
        const mH=SH*2+GAP;const y1=2,y2=y1+mH+MGAP,y3=y2+mH+MGAP;
        const mid1=y1+SH+GAP/2,mid2=y2+SH+GAP/2,mid3=y3+SH+GAP/2;
        const w=SW+CON+SW+CON+SW+CON+SW+20,h=y3+mH+4;
        let s=`<svg width="${w}" height="${h}" xmlns="http://www.w3.org/2000/svg">`;
        // R1
        for(let i=0;i<3;i++){
            const my=[y1,y2,y3][i];
            s+=slot(0,my,mm[i].a1.n,mm[i].a1.g,mm[i].a1.n==='BYE');
            s+=slot(0,my+SH+GAP,mm[i].a2.n,mm[i].a2.g,mm[i].a2.n==='BYE');
            s+=conn(SW,my+SH/2,my+SH+GAP+SH/2);
        }
        // Semi slots
        s+=empty(SW+CON,mid1-SH/2);s+=empty(SW+CON,mid2-SH/2);s+=empty(SW+CON,mid3-SH/2);
        // Semi‚ÜíQF top two
        const qfMid12=(mid1+mid2)/2;
        s+=conn(SW+CON+SW,mid1,mid2);
        s+=empty(SW+CON+SW+CON,qfMid12-SH/2);
        // Bottom passes through
        s+=ln(SW+CON+SW,mid3,SW+CON+SW+CON,mid3);
        s+=empty(SW+CON+SW+CON,mid3-SH/2);
        // Final
        s+=conn(SW+CON+SW+CON+SW,qfMid12,mid3);
        const finalMid=(qfMid12+mid3)/2;
        s+=empty(SW+CON+SW+CON+SW+CON,finalMid-SH/2);
        s+=trophy(SW+CON+SW+CON+SW+CON+SW+4,finalMid+4);
        return s+'</svg>';
    }

    // 4+ MATCHES ‚Äî just list them with connectors
    const mH=SH*2+GAP;const h=mm.length*(mH+8)+4;const w=SW+CON+SW+20;
    let s=`<svg width="${w}" height="${h}" xmlns="http://www.w3.org/2000/svg">`;
    mm.forEach((m,i)=>{
        const my=2+i*(mH+8);
        s+=slot(0,my,m.a1.n,m.a1.g,m.a1.n==='BYE');
        s+=slot(0,my+SH+GAP,m.a2.n,m.a2.g,m.a2.n==='BYE');
        s+=conn(SW,my+SH/2,my+SH+GAP+SH/2);
        const mid=my+SH+GAP/2;
        s+=empty(SW+CON,mid-SH/2);
    });
    return s+'</svg>';
}

// ====== HEIGHT ESTIMATION ======
function estH(c){
    const n=c.matches.length;const mH=SH*2+GAP;
    if(n===1&&c.matches[0].solo)return 44;
    if(n===1)return mH+20;
    if(n===2)return mH*2+MGAP+20;
    if(n===3)return mH*3+MGAP*2+20;
    return n*(mH+8)+20;
}

// ====== PAGINATE & RENDER ======
const DN={kick:'KICK JITSU',lotta:'LOTTA A TERRA',kumite:'KUMIT√à KIDS'};
let pn=0;

function render(filter){
    const out=document.getElementById('out');out.innerHTML='';pn=0;
    const dd=filter==='all'?['kick','lotta','kumite']:[filter];
    dd.forEach(disc=>{
        const cats=buildAll(disc);const maxH=880;let buf=[],bh=0;
        cats.forEach(c=>{
            const h=estH(c)+34;
            if(bh+h>maxH&&buf.length>0){mkPage(out,disc,buf);buf=[];bh=0}
            buf.push(c);bh+=h;
        });
        if(buf.length)mkPage(out,disc,buf);
    });
}

function mkPage(out,disc,cats){
    pn++;const d=document.createElement('div');d.className='a4';
    let h=`<div class="ph"><h2>Ju Jitsu Champions Cup</h2><span class="tag tag-${disc}">${DN[disc]}</span></div>`;
    cats.forEach(c=>{h+=`<div class="cb"><div class="cl">${c.cat} <span class="n">${c.cnt} atleti</span></div>${drawBracket(c)}</div>`});
    h+=`<div class="pf"><span>Ju Jitsu Champions Cup ‚Äî Tai Shin Do Kai Ryu</span><span>Pag. ${pn}</span></div>`;
    d.innerHTML=h;out.appendChild(d);
}

function go(f,el){document.querySelectorAll('.btn:not(.go)').forEach(b=>b.classList.remove('on'));el.classList.add('on');render(f)}

render('all');
</script>
</body>
</html>
