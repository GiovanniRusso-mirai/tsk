<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSK Ryu - Iscrizioni 2026</title>
    <style>
        :root { --primary: #d32f2f; --accent: #1a237e; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 10px; margin: 0; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; }
        .header { text-align: center; padding: 20px; border-bottom: 5px solid var(--primary); }
        .logo { max-width: 80px; }
        .form-section { padding: 20px; }
        .atleta-card { border: 1px solid #ddd; padding: 15px; border-radius: 12px; margin-bottom: 20px; background: #fff; position: relative; }
        .grid { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .checkbox-group { background: #f9f9f9; padding: 15px; border-radius: 8px; display: grid; gap: 10px; }
        .disabilita { opacity: 0.5; pointer-events: none; }
        .footer-check { margin-top: 20px; padding: 15px; background: #fff5f5; border: 1px solid var(--primary); border-radius: 8px; font-size: 0.85rem; }
        button { width: 100%; padding: 15px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-submit { background: var(--primary); color: white; font-size: 1.1rem; }
        @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="https://scontent-fco2-1.xx.fbcdn.net/v/t39.30808-6/299940804_510546830876553_8892043649465700842_n.png?..." class="logo">
        <h2 style="color:var(--accent); margin:10px 0;">Tai Shin Do Kai Ryu</h2>
    </div>

    <form id="torneoForm" class="form-section">
        <div class="grid">
            <input type="text" id="palestra" placeholder="Nome Palestra" required>
            <input type="text" id="responsabile" placeholder="Nome Responsabile" required>
        </div>

        <div id="listaAtleti"></div>

        <button type="button" onclick="renderAtleta()" style="background:#eee; border:1px dashed #999;">+ AGGIUNGI ATLETA</button>

        <div class="footer-check">
            <label style="display:flex; gap:10px; cursor:pointer;">
                <input type="checkbox" id="checkMedica" required>
                <span>Dichiaro che tutti gli atleti sono in possesso di certificato medico agonistico e assicurazione personale [Art.16/17].</span>
            </label>
        </div>

        <button type="submit" class="btn-submit">REVISIONE E INVIO</button>
    </form>
</div>

<script>
    const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbyy9TpDCSXKG6hJCq3M16hL9hx4icWzBfI_SiYhjc5xKa7ViopcrHsu2K8-gg0Mhbk-kw/exec";

    function renderAtleta() {
        const container = document.getElementById('listaAtleti');
        const id = Date.now();
        const div = document.createElement('div');
        div.className = 'atleta-card';
        div.innerHTML = `
            <div class="grid">
                <input type="text" class="nome" placeholder="Nome Atleta" required>
                <input type="number" class="peso" placeholder="Peso kg" required>
                <input type="number" class="eta" placeholder="Età" onchange="validaEta(this)" required>
            </div>
            <div class="checkbox-group">
                <label class="check-item"><input type="checkbox" class="gara" value="Kumitè Kids"> Kumitè Kids (4-11 anni)</label>
                <label class="check-item gara-extra"><input type="checkbox" class="gara" value="Kick Jitsu"> Kick Jitsu (Dai 12 anni)</label>
                <label class="check-item gara-extra"><input type="checkbox" class="gara" value="Lotta a terra"> Lotta a terra (Dai 12 anni)</label>
            </div>
        `;
        container.appendChild(div);
    }

    function validaEta(input) {
        const card = input.closest('.atleta-card');
        const eta = parseInt(input.value);
        const extraGare = card.querySelectorAll('.gara-extra');
        
        if (eta >= 4 && eta <= 7) {
            extraGare.forEach(el => {
                el.classList.add('disabilita');
                el.querySelector('input').checked = false;
            });
            alert("Per atleti dai 4 ai 7 anni è consentito solo Kumitè Kids.");
        } else {
            extraGare.forEach(el => el.classList.remove('disabilita'));
        }
    }

    document.getElementById('torneoForm').onsubmit = async (e) => {
        e.preventDefault();
        const payload = {
            palestra: document.getElementById('palestra').value,
            responsabile: document.getElementById('responsabile').value,
            accettoMedica: document.getElementById('checkMedica').checked,
            atleti: Array.from(document.getElementsByClassName('atleta-card')).map(card => ({
                nome: card.querySelector('.nome').value,
                peso: card.querySelector('.peso').value,
                eta: card.querySelector('.eta').value,
                gare: Array.from(card.querySelectorAll('.gara:checked')).map(c => c.value)
            }))
        };
        alert("Invio in corso...");
        await fetch(GOOGLE_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
        alert("Iscrizioni inviate correttamente!");
        location.reload();
    };

    renderAtleta();
</script>
</body>
</html>
