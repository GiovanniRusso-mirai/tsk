<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ju Jitsu Champions Cup - TSK</title>
    <style>
        :root { --primary: #d32f2f; --accent: #1a237e; --bg: #f4f7f6; --success: #27ae60; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: #333; margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; }
        
        /* Header */
        .header { text-align: center; padding: 25px 20px; border-bottom: 5px solid var(--primary); background: white; }
        .logo { max-width: 120px; height: auto; margin-bottom: 15px; display: block; margin-left: auto; margin-right: auto; }
        h1 { margin: 0; font-size: 1.8rem; color: var(--accent); text-transform: uppercase; }
        h2 { margin: 5px 0 0; font-size: 1rem; color: #666; font-weight: 400; }
        
        .form-section { padding: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        
        .atleta-card { background: #fff; border: 1px solid #ddd; border-radius: 12px; padding: 20px; margin-bottom: 20px; position: relative; border-left: 5px solid var(--accent); }
        .atleta-grid { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        
        label { display: block; font-size: 0.75rem; font-weight: 700; margin-bottom: 5px; color: #444; text-transform: uppercase; }
        input { width: 100%; padding: 12px; border: 2px solid #dfe6e9; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        input:focus { border-color: var(--accent); outline: none; }

        .checkbox-group { display: flex; flex-direction: column; gap: 12px; background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #eee; }
        .checkbox-item { display: flex; align-items: center; gap: 10px; font-weight: 600; cursor: pointer; font-size: 0.95rem; }
        .checkbox-item input { width: 18px; height: 18px; margin: 0; cursor: pointer; flex-shrink: 0; }
        
        .disabilitato { opacity: 0.4; pointer-events: none; text-decoration: line-through; }
        
        .medica-box { background: #fff5f5; border: 1px solid var(--primary); padding: 15px; border-radius: 8px; margin: 25px 0; display: flex; align-items: flex-start; gap: 12px; }
        .medica-box input { width: 18px; height: 18px; margin-top: 2px; flex-shrink: 0; cursor: pointer; }
        .medica-box label { text-transform: none; font-weight: 500; font-size: 0.85rem; color: #b71c1c; cursor: pointer; line-height: 1.4; }

        .btn-submit { width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 10px; font-weight: 800; cursor: pointer; font-size: 1.2rem; transition: background 0.2s; }
        .btn-submit:hover { background: #b71c1c; }
        .btn-add { width: 100%; padding: 15px; background: #fff; border: 2px dashed #bbb; color: #555; cursor: pointer; border-radius: 10px; margin-bottom: 20px; font-weight: bold; font-size: 1rem; }
        
        .remove-atleta { position: absolute; top: 10px; right: 10px; color: #ff5252; background: none; border: none; font-weight: bold; cursor: pointer; font-size: 0.8rem; }

        /* Messaggi in pagina */
        #statusMessage { display: none; margin-top: 20px; padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; }
        .status-loading { background: #e3f2fd; color: #1565c0; border: 1px solid #90caf9; }
        .status-success { background: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; }
        .status-error { background: #ffebee; color: #c62828; border: 1px solid #ef9a9a; }

        @media (max-width: 600px) {
            .grid, .atleta-grid { grid-template-columns: 1fr; }
            h1 { font-size: 1.4rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="299940804_510546830876553_8892043649465700842_n.png" class="logo" alt="Logo TSK" onerror="this.style.display='none'">
        <h1>Ju Jitsu Champions Cup</h1>
        <h2>Tai Shin Do Kai Ryu</h2>
    </div>

    <form id="torneoForm" class="form-section">
        <div class="grid">
            <div><label>Nome ASD / Palestra</label><input type="text" id="palestra" placeholder="Es. Budokan Dojo" required></div>
            <div><label>Responsabile Tecnico</label><input type="text" id="responsabile" placeholder="Nome e Cognome" required></div>
        </div>

        <div id="listaAtleti"></div>
        <button type="button" class="btn-add" onclick="renderAtleta()">+ AGGIUNGI ATLETA</button>
        
        <div class="medica-box">
            <input type="checkbox" id="checkMedica" required>
            <label for="checkMedica">
                Dichiaro, sotto la mia responsabilità, che tutti gli atleti iscritti sono in possesso di certificato medico agonistico e assicurazione personale in corso di validità [Art. [cite_start]16/17]. [cite: 1, 16, 17]
            </label>
        </div>

        <button type="submit" id="submitBtn" class="btn-submit">REVISIONE E INVIO</button>
        <div id="statusMessage"></div>
    </form>
</div>

<script>
    const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbyy9TpDCSXKG6hJCq3M16hL9hx4icWzBfI_SiYhjc5xKa7ViopcrHsu2K8-gg0Mhbk-kw/exec";

    function showStatus(text, type) {
        const msg = document.getElementById('statusMessage');
        msg.innerText = text;
        msg.className = 'status-' + type;
        msg.style.display = 'block';
        if(type === 'success') {
            setTimeout(() => { location.reload(); }, 3000);
        }
    }

    function renderAtleta() {
        const container = document.getElementById('listaAtleti');
        const count = container.children.length + 1;
        const div = document.createElement('div');
        div.className = 'atleta-card';
        div.innerHTML = `
            <button type="button" class="remove-atleta" onclick="this.parentElement.remove()">ELIMINA</button>
            <div style="margin-bottom:15px; color:var(--accent); font-weight:bold;">ISCRIZIONE ATLETA #${count}</div>
            <div class="atleta-grid">
                <div><label>Nome e Cognome</label><input type="text" class="nome" required></div>
                <div><label>Peso (kg)</label><input type="number" class="peso" step="0.1" required></div>
                <div><label>Età (Anni)</label><input type="number" class="eta" onchange="checkVincoli(this)" required></div>
            </div>
            <label>Discipline di Gara:</label>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" class="gara" value="Kumitè Kids"> Kumitè Kids (4-11 anni)</label>
                <label class="checkbox-item extra-gara"><input type="checkbox" class="gara" value="Kick Jitsu"> Kick Jitsu (7-15 anni)</label>
                <label class="checkbox-item extra-gara"><input type="checkbox" class="gara" value="Lotta a terra"> Lotta a terra (7-15 anni)</label>
            </div>`;
        container.appendChild(div);
    }

    function checkVincoli(input) {
        const card = input.closest('.atleta-card');
        const eta = parseInt(input.value);
        const extraGare = card.querySelectorAll('.extra-gara');
        
        if (eta < 7) {
            extraGare.forEach(el => {
                el.classList.add('disabilitato');
                el.querySelector('input').checked = false;
            });
        } else {
            extraGare.forEach(el => el.classList.remove('disabilitato'));
        }
    }

    document.getElementById('torneoForm').onsubmit = async (e) => {
        e.preventDefault();
        
        const atletiCards = document.getElementsByClassName('atleta-card');
        if (atletiCards.length === 0) {
            showStatus("Aggiungi almeno un atleta!", "error");
            return;
        }

        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        showStatus("Invio in corso... attendi la conferma.", "loading");

        const payload = {
            palestra: document.getElementById('palestra').value,
            responsabile: document.getElementById('responsabile').value,
            accettoMedica: document.getElementById('checkMedica').checked,
            atleti: Array.from(atletiCards).map(card => ({
                nome: card.querySelector('.nome').value,
                peso: card.querySelector('.peso').value,
                eta: card.querySelector('.eta').value,
                gare: Array.from(card.querySelectorAll('.gara:checked')).map(c => c.value)
            }))
        };

        try {
            await fetch(GOOGLE_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
            showStatus("ISCRIZIONI INVIATE CON SUCCESSO! La pagina si ricaricherà tra poco.", "success");
        } catch (error) {
            showStatus("Errore nell'invio. Verifica la connessione e riprova.", "error");
            submitBtn.disabled = false;
        }
    };

    renderAtleta();
</script>
</body>
</html>
